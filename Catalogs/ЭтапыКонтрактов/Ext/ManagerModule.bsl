
Функция СуммаЭтаповКонтракта(Владелец, ТипыЭтапов = Неопределено) Экспорт
	СуммаЭтаповКонтракта = 0;
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	ЭтапыКонтрактов.Владелец,
	|	СУММА(ЭтапыКонтрактов.СуммаОплаты) КАК Сумма
	|ИЗ
	|	Справочник.ЭтапыКонтрактов КАК ЭтапыКонтрактов
	|ГДЕ
	|	ЭтапыКонтрактов.Владелец = &Владелец
	|
	|СГРУППИРОВАТЬ ПО
	|	ЭтапыКонтрактов.Владелец";
	
	Запрос.УстановитьПараметр("Владелец", Владелец);
	
	Если ТипЗнч(ТипыЭтапов) = Тип("Массив") 
		Или ТипЗнч(ТипыЭтапов) = Тип("ПеречислениеСсылка.ТипыЭтаповКонтрактов") Тогда
		Запрос.Текст = Запрос.Текст + "И ЭтапыКонтрактов.ТипЭтапа В (&ТипыЭтапов)";
		Запрос.УстановитьПараметр("ТипыЭтапов", ТипыЭтапов);
	КонецЕсли;
	РезультатЗапроса = Запрос.Выполнить();
	
	Если Не РезультатЗапроса.Пустой() Тогда
		Выборка = РезультатЗапроса.Выбрать();
		Выборка.Следующий();
		
		СуммаЭтаповКонтракта = Выборка.Сумма;
	КонецЕсли;
	
	Возврат СуммаЭтаповКонтракта;
КонецФункции
