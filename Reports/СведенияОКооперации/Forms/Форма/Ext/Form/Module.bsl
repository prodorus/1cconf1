//#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Отчет.КонтрактСЗаказчиком = Параметры.Ссылка;
	
	Приложение1 = Параметры.Свойство("Приложение1") И Параметры.Приложение1;
	Приложения2и3 = Параметры.Свойство("Приложения2и3") И Параметры.Приложения2и3;
	
	Заголовок = Заголовок + ?(Приложение1, " (" + НСтр("ru= 'Приложение 1'") + ")", " (" + НСтр("ru= 'Приложения 2 и 3'") + ")");
	
	ОбновитьНаСервере();
КонецПроцедуры

//#КонецОбласти 

//#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Обновить(Команда)
	ОбновитьНаСервере();
КонецПроцедуры

//#КонецОбласти 

//#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ОбновитьНаСервере()
	Результат.Очистить();
	
	// Добавим фиксированные параметры
	Запрос = Новый Запрос;
	Запрос.Текст = ИсточникиДанных275Сервер.ТекстЗапросаСведенияОКооперации();
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ТекстОтбораПоКонтрактуЗаказчика", "КонтрактыИсполнителейНомераКонтрактов.КонтрактСЗаказчиком = &КонтрактСЗаказчиком");

	Запрос.УстановитьПараметр("КонтрактСЗаказчиком", Отчет.КонтрактСЗаказчиком);
	ДанныеОКонтрактах = Запрос.Выполнить().Выгрузить();
	
	//#Область ВыводПриложения1
	
	Если Приложение1 Тогда
		Макет = Отчеты.СведенияОКооперации.ПолучитьМакет("ПФ_Приложение1");
		
		НомерСтроки = 1;
		ШапкаВыведена = Ложь;
		Для Каждого ДанныеКонтракта Из ДанныеОКонтрактах Цикл 
			Если Не ШапкаВыведена Тогда
				ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
				ОбластьШапка.Параметры.Заполнить(ДанныеКонтракта);
				
				ГосударственныйКонтрактДатаЗаключения = ДанныеКонтракта.ГосударственныйКонтракт.ДатаЗаключения;
				ГосударственныйКонтрактНомер = ДанныеКонтракта.ГосударственныйКонтракт;
	
				ОбластьШапка.Параметры["ГосударственныйКонтрактДень"] = День(ГосударственныйКонтрактДатаЗаключения);
				ОбластьШапка.Параметры["ГосударственныйКонтрактМесяцПрописью"] = МесяцПрописью(Месяц(ГосударственныйКонтрактДатаЗаключения));
				ОбластьШапка.Параметры["ГосударственныйКонтрактГод"] = Формат(Год(ГосударственныйКонтрактДатаЗаключения), "ЧГ=0");
				ОбластьШапка.Параметры["ГосударственныйКонтрактНомер"] = ГосударственныйКонтрактНомер;
				
				ОбластьШапка.Параметры["ГосударственныйКонтрактСрокИсполнения"] = Строка(Формат(ДанныеКонтракта.ГосударственныйКонтрактСрокиГодЗаключения, "ЧГ=0")) 
					+ НСтр("ru= ' - '") + Строка(Формат(ДанныеКонтракта.ГосударственныйКонтрактСрокиГодОкончанияСрокаДействия, "ЧГ=0")) + НСтр("ru= ' гг.'") ;
					
				ОбластьШапка.Параметры["ГосударственныйКонтрактСумма"] = ДанныеКонтракта.КонтрактСЗаказчикомСумма;
					
				Результат.Вывести(ОбластьШапка);
			
				ОбластьОтступ = Макет.ПолучитьОбласть("Отступ");
				Результат.Вывести(ОбластьОтступ);
				
				ОбластьШапка = Макет.ПолучитьОбласть("ШапкаТаблицы");
				Результат.Вывести(ОбластьШапка);
				
				ШапкаВыведена = Истина;
			КонецЕсли;
			
			Если Не ДанныеКонтракта.ЭтоИностранныйИсполнитель Тогда
				ОбластьСтрокаТаблицы = Макет.ПолучитьОбласть("СтрокаТаблицы");
				ОбластьСтрокаТаблицы.Параметры["НомерСтроки"] = НомерСтроки;
				
				МассивСтрокНаименования = Новый Массив;
				Если ЗначениеЗаполнено(ДанныеКонтракта.ИсполнительНаименованиеПолное) Тогда
					МассивСтрокНаименования.Добавить(ДанныеКонтракта.ИсполнительНаименованиеПолное);
				КонецЕсли;
				Если ЗначениеЗаполнено(ДанныеКонтракта.ИсполнительМестоНахождения) Тогда
					МассивСтрокНаименования.Добавить(ДанныеКонтракта.ИсполнительМестоНахождения);
				КонецЕсли;
				СтрокаНаименованиеПолное = СтроковыеФункцииКлиентСервер.ПолучитьСтрокуИзМассиваПодстрок(МассивСтрокНаименования, ", ");
				ОбластьСтрокаТаблицы.Параметры["ИсполнительНаименованиеПолное"] = ?(ЗначениеЗаполнено(СтрокаНаименованиеПолное), СтрокаНаименованиеПолное, НСтр("ru= '<Полное наименование, адрес, телефоны не указаны>'"));
				
				МассивСтрокИННКПП = Новый Массив;
				Если ЗначениеЗаполнено(ДанныеКонтракта.ИсполнительИНН) Тогда
					МассивСтрокИННКПП.Добавить(НСтр("ru= 'ИНН:'") + ДанныеКонтракта.ИсполнительИНН);
				КонецЕсли;
				Если ЗначениеЗаполнено(ДанныеКонтракта.ИсполнительКПП) Тогда
					МассивСтрокИННКПП.Добавить(НСтр("ru= 'КПП:'") + ДанныеКонтракта.ИсполнительКПП);
				КонецЕсли;
				СтрокаИНН_КПП = СтроковыеФункцииКлиентСервер.ПолучитьСтрокуИзМассиваПодстрок(МассивСтрокИННКПП, ", ");
				ОбластьСтрокаТаблицы.Параметры["ИНН_КПП"] = ?(ЗначениеЗаполнено(СтрокаИНН_КПП), СтрокаИНН_КПП, НСтр("ru= '<ИНН и КПП не указаны>'"));
				
				МассивСтрокНомерДата = Новый Массив;
				Если ЗначениеЗаполнено(ДанныеКонтракта.КонтрактСИсполнителемНомер) Тогда
					МассивСтрокНомерДата.Добавить(ДанныеКонтракта.КонтрактСИсполнителемНомер);
				КонецЕсли;
				Если ЗначениеЗаполнено(ДанныеКонтракта.КонтрактСИсполнителемДата) Тогда
					МассивСтрокНомерДата.Добавить(НСтр("ru= 'от '") + Строка(Формат(ДанныеКонтракта.КонтрактСИсполнителемДата, "Л=ru_RU; ДФ=dd.MM.yyyy")));
				КонецЕсли;
				СтрокаДатаИНомер = СтроковыеФункцииКлиентСервер.ПолучитьСтрокуИзМассиваПодстрок(МассивСтрокНомерДата, " ");
				ОбластьСтрокаТаблицы.Параметры["КонтрактСИсполнителемДатаИНомер"] = ?(ЗначениеЗаполнено(СтрокаДатаИНомер), СтрокаДатаИНомер, НСтр("ru= '<Номер и дата не указаны>'"));
				
				ОбластьСтрокаТаблицы.Параметры["КонтрактСИсполнителемПредмет"] = ДанныеКонтракта.КонтрактСИсполнителемПредмет;
				ОбластьСтрокаТаблицы.Параметры["КонтрактСИсполнителемСумма"] = ДанныеКонтракта.КонтрактСИсполнителемСумма;
				ОбластьСтрокаТаблицы.Параметры["СпособОпределенияПоставщика"] = ДанныеКонтракта.КонтрактСИсполнителемСпособОпределенияПоставщика;
				
				Результат.Вывести(ОбластьСтрокаТаблицы);
				
				НомерСтроки = НомерСтроки + 1;
			КонецЕсли;
		КонецЦикла;
		
		Результат.ВывестиГоризонтальныйРазделительСтраниц();
	КонецЕсли;
	
	//#КонецОбласти 
	
	Если Приложения2и3 Тогда
		
		//#Область ВыводПриложения2
		
		Макет = Отчеты.СведенияОКооперации.ПолучитьМакет("ПФ_Приложение2");
		
		НомерСтроки = 1;
		ШапкаВыведена = Ложь;
		Для Каждого ДанныеКонтракта Из ДанныеОКонтрактах Цикл 
			Если Не ШапкаВыведена Тогда
				ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
				ОбластьШапка.Параметры.Заполнить(ДанныеКонтракта);
				ОбластьШапка.Параметры["КонтрактСЗаказчикомСрокИсполнения"] = Строка(Формат(ДанныеКонтракта.КонтрактСЗаказчикомДатаНачала, "Л=ru_RU; ДФ=dd.MM.yyyy")) + НСтр("ru= ' г.'") 
					+ НСтр("ru= ' - '") + Строка(Формат(ДанныеКонтракта.КонтрактСЗаказчикомДатаОкончания, "Л=ru_RU; ДФ=dd.MM.yyyy")) + НСтр("ru= ' г.'") ;
					
				Результат.Вывести(ОбластьШапка);
			
				ОбластьОтступ = Макет.ПолучитьОбласть("Отступ");
				Результат.Вывести(ОбластьОтступ);
				
				ОбластьШапка = Макет.ПолучитьОбласть("ШапкаТаблицы");
				Результат.Вывести(ОбластьШапка);
				
				ШапкаВыведена = Истина;
			КонецЕсли;
			
			Если Не ДанныеКонтракта.ЭтоИностранныйИсполнитель Тогда
				ОбластьСтрокаТаблицы = Макет.ПолучитьОбласть("СтрокаТаблицы");
				ОбластьСтрокаТаблицы.Параметры["НомерСтроки"] = НомерСтроки;
				
				МассивСтрокНаименования = Новый Массив;
				Если ЗначениеЗаполнено(ДанныеКонтракта.ИсполнительНаименованиеПолное) Тогда
					МассивСтрокНаименования.Добавить(ДанныеКонтракта.ИсполнительНаименованиеПолное);
				КонецЕсли;
				Если ЗначениеЗаполнено(ДанныеКонтракта.ИсполнительМестоНахождения) Тогда
					МассивСтрокНаименования.Добавить(ДанныеКонтракта.ИсполнительМестоНахождения);
				КонецЕсли;
				СтрокаНаименованиеПолное = СтроковыеФункцииКлиентСервер.ПолучитьСтрокуИзМассиваПодстрок(МассивСтрокНаименования, ", ");
				ОбластьСтрокаТаблицы.Параметры["ИсполнительНаименованиеПолное"] = ?(ЗначениеЗаполнено(СтрокаНаименованиеПолное), СтрокаНаименованиеПолное, НСтр("ru= '<Полное наименование, адрес, телефоны не указаны>'"));
				
				МассивСтрокИННКПП = Новый Массив;
				Если ЗначениеЗаполнено(ДанныеКонтракта.ИсполнительИНН) Тогда
					МассивСтрокИННКПП.Добавить(НСтр("ru= 'ИНН:'") + ДанныеКонтракта.ИсполнительИНН);
				КонецЕсли;
				Если ЗначениеЗаполнено(ДанныеКонтракта.ИсполнительКПП) Тогда
					МассивСтрокИННКПП.Добавить(НСтр("ru= 'КПП:'") + ДанныеКонтракта.ИсполнительКПП);
				КонецЕсли;
				СтрокаИНН_КПП = СтроковыеФункцииКлиентСервер.ПолучитьСтрокуИзМассиваПодстрок(МассивСтрокИННКПП, ", ");
				ОбластьСтрокаТаблицы.Параметры["ИНН_КПП"] = ?(ЗначениеЗаполнено(СтрокаИНН_КПП), СтрокаИНН_КПП, НСтр("ru= '<ИНН и КПП не указаны>'"));
				
				МассивСтрокНомерДата = Новый Массив;
				Если ЗначениеЗаполнено(ДанныеКонтракта.КонтрактСИсполнителемНомер) Тогда
					МассивСтрокНомерДата.Добавить(ДанныеКонтракта.КонтрактСИсполнителемНомер);
				КонецЕсли;
				Если ЗначениеЗаполнено(ДанныеКонтракта.КонтрактСИсполнителемДата) Тогда
					МассивСтрокНомерДата.Добавить(НСтр("ru= 'от '") + Строка(Формат(ДанныеКонтракта.КонтрактСИсполнителемДата, "Л=ru_RU; ДФ=dd.MM.yyyy")));
				КонецЕсли;
				СтрокаДатаИНомер = СтроковыеФункцииКлиентСервер.ПолучитьСтрокуИзМассиваПодстрок(МассивСтрокНомерДата, " ");
				ОбластьСтрокаТаблицы.Параметры["КонтрактСИсполнителемДатаИНомер"] = ?(ЗначениеЗаполнено(СтрокаДатаИНомер), СтрокаДатаИНомер, НСтр("ru= '<Номер и дата не указаны>'"));
				
				ОбластьСтрокаТаблицы.Параметры["КонтрактСИсполнителемПредмет"] = ДанныеКонтракта.КонтрактСИсполнителемПредмет;
				ОбластьСтрокаТаблицы.Параметры["КонтрактСИсполнителемСумма"] = ДанныеКонтракта.КонтрактСИсполнителемСумма;
				ОбластьСтрокаТаблицы.Параметры["СпособОпределенияПоставщика"] = ДанныеКонтракта.КонтрактСИсполнителемСпособОпределенияПоставщика;
				
				Результат.Вывести(ОбластьСтрокаТаблицы);
				
				НомерСтроки = НомерСтроки + 1;
			КонецЕсли;
		КонецЦикла;
		
		Результат.ВывестиГоризонтальныйРазделительСтраниц();
		
		//#КонецОбласти 
		
		//#Область ВыводПриложения3
			
		Макет = Отчеты.СведенияОКооперации.ПолучитьМакет("ПФ_Приложение3");
		
		НомерСтроки = 1;
		ШапкаВыведена = Ложь;
		Для Каждого ДанныеКонтракта Из ДанныеОКонтрактах Цикл 
			Если Не ШапкаВыведена Тогда
				ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
				ОбластьШапка.Параметры.Заполнить(ДанныеКонтракта);
				
				ГосударственныйКонтрактДатаЗаключения = ДанныеКонтракта.ГосударственныйКонтракт.ДатаЗаключения;
				ГосударственныйКонтрактНомер = ДанныеКонтракта.ГосударственныйКонтракт;
	
				ОбластьШапка.Параметры["ГосударственныйКонтрактДень"] = День(ГосударственныйКонтрактДатаЗаключения);
				ОбластьШапка.Параметры["ГосударственныйКонтрактМесяцПрописью"] = МесяцПрописью(Месяц(ГосударственныйКонтрактДатаЗаключения));
				ОбластьШапка.Параметры["ГосударственныйКонтрактГод"] = Формат(Год(ГосударственныйКонтрактДатаЗаключения), "ЧГ=0");
				ОбластьШапка.Параметры["ГосударственныйКонтрактНомер"] = ГосударственныйКонтрактНомер;
				
				ОбластьШапка.Параметры["ГосударственныйКонтрактСрокИсполнения"] = Строка(Формат(ДанныеКонтракта.ГосударственныйКонтрактСрокиГодЗаключения, "ЧГ=0")) 
					+ НСтр("ru= ' - '") + Строка(Формат(ДанныеКонтракта.ГосударственныйКонтрактСрокиГодОкончанияСрокаДействия, "ЧГ=0")) + НСтр("ru= ' гг.'") ;
					
				ОбластьШапка.Параметры["ГосударственныйКонтрактСумма"] = ДанныеКонтракта.КонтрактСЗаказчикомСумма;
					
				Результат.Вывести(ОбластьШапка);
				
				ОбластьОтступ = Макет.ПолучитьОбласть("Отступ");
				Результат.Вывести(ОбластьОтступ);
				
				ОбластьШапка = Макет.ПолучитьОбласть("ШапкаТаблицы");
				Результат.Вывести(ОбластьШапка);
				
				ШапкаВыведена = Истина;
			КонецЕсли;
			
			Если ДанныеКонтракта.ЭтоИностранныйИсполнитель Тогда
				ОбластьСтрокаТаблицы = Макет.ПолучитьОбласть("СтрокаТаблицы");
				ОбластьСтрокаТаблицы.Параметры["НомерСтроки"] = НомерСтроки;
				
				МассивСтрокНаименования = Новый Массив;
				Если ЗначениеЗаполнено(ДанныеКонтракта.ИсполнительНаименованиеПолное) Тогда
					МассивСтрокНаименования.Добавить(ДанныеКонтракта.ИсполнительНаименованиеПолное);
				КонецЕсли;
				Если ЗначениеЗаполнено(ДанныеКонтракта.ИсполнительМестоНахождения) Тогда
					МассивСтрокНаименования.Добавить(ДанныеКонтракта.ИсполнительМестоНахождения);
				КонецЕсли;
				СтрокаНаименованиеПолное = СтроковыеФункцииКлиентСервер.ПолучитьСтрокуИзМассиваПодстрок(МассивСтрокНаименования, ", ");
				ОбластьСтрокаТаблицы.Параметры["ИсполнительНаименованиеПолное"] = ?(ЗначениеЗаполнено(СтрокаНаименованиеПолное), СтрокаНаименованиеПолное, НСтр("ru= '<Полное наименование, адрес, телефоны не указаны>'"));
				
				ОбластьСтрокаТаблицы.Параметры["ИсполнительРегистрационныйНомер"] = ?(ЗначениеЗаполнено(ДанныеКонтракта.ИсполнительРегистрационныйНомер), ДанныеКонтракта.ИсполнительРегистрационныйНомер, НСтр("ru= 'Рег. номер не указан'"));
				ОбластьСтрокаТаблицы.Параметры["КонтрактСИсполнителемОснование"] = ДанныеКонтракта.КонтрактСИсполнителемОснование;
				ОбластьСтрокаТаблицы.Параметры["КонтрактСИсполнителемПредмет"] = ДанныеКонтракта.КонтрактСИсполнителемПредмет;
				
				МассивСтрокНомерДата = Новый Массив;
				Если ЗначениеЗаполнено(ДанныеКонтракта.КонтрактСИсполнителемНомер) Тогда
					МассивСтрокНомерДата.Добавить(ДанныеКонтракта.КонтрактСИсполнителемНомер);
				КонецЕсли;
				Если ЗначениеЗаполнено(ДанныеКонтракта.КонтрактСИсполнителемДата) Тогда
					МассивСтрокНомерДата.Добавить(НСтр("ru= 'от '") + Строка(Формат(ДанныеКонтракта.КонтрактСИсполнителемДата, "Л=ru_RU; ДФ=dd.MM.yyyy")));
				КонецЕсли;
				СтрокаДатаИНомер = СтроковыеФункцииКлиентСервер.ПолучитьСтрокуИзМассиваПодстрок(МассивСтрокНомерДата, " ");
				ОбластьСтрокаТаблицы.Параметры["КонтрактСИсполнителемДатаИНомер"] = ?(ЗначениеЗаполнено(СтрокаДатаИНомер), СтрокаДатаИНомер, НСтр("ru= '<Номер и дата не указаны>'"));
				
				ОбластьСтрокаТаблицы.Параметры["КонтрактСИсполнителемСумма"] = ДанныеКонтракта.КонтрактСИсполнителемСумма;
				ОбластьСтрокаТаблицы.Параметры["СпособОпределенияПоставщика"] = ДанныеКонтракта.КонтрактСИсполнителемСпособОпределенияПоставщика;
				
				Результат.Вывести(ОбластьСтрокаТаблицы);
				
				НомерСтроки = НомерСтроки + 1;
			КонецЕсли;
		КонецЦикла;
		
		//#КонецОбласти 
	
	КонецЕсли;
	
	// Параметры печати
	Результат.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
	Результат.АвтоМасштаб = Истина;
	
	// Поля
	Результат.ПолеСверху = 5;
	Результат.ПолеСнизу = 10;
	Результат.ПолеСлева = 5;
	Результат.ПолеСправа = 5;
	
	Результат.РазмерКолонтитулаСверху = 5;
	Результат.РазмерКолонтитулаСнизу = 5;
	
	// Колонтитулы
	Результат.НижнийКолонтитул.Выводить = Истина;
	Результат.НижнийКолонтитул.ТекстСправа = НСтр("ru= 'Страница [&НомерСтраницы] из [&СтраницВсего]'");
	
	// Прочие параметры
	Результат.Защита = Истина;
	Результат.ОтображатьЗаголовки = Ложь;
	Результат.ОтображатьСетку = Ложь;
	Результат.КлючПараметровПечати = "ПечатнаяФормаСведенийОКооперации";
	Результат.ИспользуемоеИмяФайла = НСтр("ru= 'Сведения о кооперации'") + ?(Приложение1, " (" + НСтр("ru= 'Приложение 1'") + ")", " (" + НСтр("ru= 'Приложения 2 и 3'") + ")") + " " + Отчет.КонтрактСЗаказчиком;
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста 
Функция МесяцПрописью(НомерМесяца)
	МесяцПрописью = "";
	
	Если НомерМесяца = 1 Тогда
		МесяцПрописью = НСтр("ru= 'января'");
	ИначеЕсли НомерМесяца = 2 Тогда
		МесяцПрописью = НСтр("ru= 'февраля'");
	ИначеЕсли НомерМесяца = 3 Тогда
		МесяцПрописью = НСтр("ru= 'марта'");
	ИначеЕсли НомерМесяца = 4 Тогда
		МесяцПрописью = НСтр("ru= 'апреля'");
	ИначеЕсли НомерМесяца = 5 Тогда
		МесяцПрописью = НСтр("ru= 'мая'");
	ИначеЕсли НомерМесяца = 6 Тогда
		МесяцПрописью = НСтр("ru= 'июня'");
	ИначеЕсли НомерМесяца = 7 Тогда
		МесяцПрописью = НСтр("ru= 'июля'");
	ИначеЕсли НомерМесяца = 8 Тогда
		МесяцПрописью = НСтр("ru= 'августа'");
	ИначеЕсли НомерМесяца = 9 Тогда
		МесяцПрописью = НСтр("ru= 'сентября'");
	ИначеЕсли НомерМесяца = 10 Тогда
		МесяцПрописью = НСтр("ru= 'октября'");
	ИначеЕсли НомерМесяца = 11 Тогда
		МесяцПрописью = НСтр("ru= 'ноября'");
	ИначеЕсли НомерМесяца = 12 Тогда
		МесяцПрописью = НСтр("ru= 'декабря'");
	КонецЕсли;
	
	Возврат МесяцПрописью;
КонецФункции

//#КонецОбласти 
